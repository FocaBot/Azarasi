<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: permissions.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: permissions.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Handles permissions depending on roles.
 */
class PermissionsManager {
  constructor() {
    /**
     * Array of owner user IDs
     * @type {string[]}
     */
    this.owner = Core.settings.owner || [];
    /**
     * Array of admin user IDs
     * @type {string[]}
     */
    this.admins = Core.settings.admins || [];
    /**
     * Array of admin role names
     * @type {string[]}
     */
    this.adminRoles = Core.settings.adminRoles || [];
    /**
     * Array of DJ role names
     * @type {string[]}
     */
    this.djRoles = Core.settings.djRoles || [];
  }

  /**
   * Checks if an user has certain roles (by name).
   *
   * Note: Only one of the roles passed is required for this to return a positive value.
   * @param {string|string[]} roles - Role name(s) to check.
   * @param {object} user - The user to check. Can also be a Discordie IGuildMember.
   * @param {object} guild - The guild to check. Not needed if user is an IGuildMember.
   * @return {boolean}
   */
  hasRoles(roles, user, guild = user.guild) {
    if (!guild) return false; // DMs have no guild object
    const member = user.memberOf(guild);
    if (!member) return false; // wut?
    const r = (typeof roles === 'string') ? [roles] : roles;
    return member.roles.filter(i => r.indexOf(i.name) >= 0).length > 0;
  }

  /**
   * Checks if an user has admin rights.
   * @param {object} user - The user to check. Can also be a Discordie IGuildMember.
   * @param {object} guild - The guild to check. Not needed if user is an IGuildMember.
   * @param {boolean} globalOnly - Check only for global admins.
   * @return {boolean}
   */
  isAdmin(user, guild = user.guild, globalOnly) {
    // always return true for global admins and bot owners
    if (this.admins.indexOf(user.id) >= 0 || this.isOwner(user)) return true;
    if (globalOnly) return false;
    if (!guild) return false;
    if (user.id === guild.owner_id) return true; // Owner of guild
    return this.hasRoles(this.adminRoles, user, guild);
  }

  /**
   * Checks if an user has DJ roles.
   * @param {object} user - The user to check. Can also be a Discordie IGuildMember.
   * @param {object} guild - The guild to check. Not needed if user is an IGuildMember.
   * @return {boolean}
   */
  isDJ(user, guild = user.guild) {
    // always return true for global admins and bot owners
    if (this.admins.indexOf(user.id) >= 0 || this.isOwner(user)) return true;
    if (!guild) return false; // DMs have no guild object
    if (user.id === guild.owner_id) return true; // Owner of guild
    return this.hasRoles(this.djRoles, user, guild) || this.hasRoles(this.adminRoles, user, guild);
  }

  /**
   * Checks if an user is the guild owner.
   * @param {object} user - The user or member to check
   * @param {object} guild - The guild to check
   * @return {boolean}
   */
  isGuildOwner(user, guild = user.guild) {
    return user.id === guild.owner_id || this.isOwner(user);
  }

  /**
   * Check if an user is the bot owner
   * @param {object} user - User to check
   * @return {boolean}
   */
  isOwner(user) {
    return this.owner.indexOf(user.id) >= 0;
  }
}

module.exports = PermissionsManager;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BotCommand.html">BotCommand</a></li><li><a href="BotModule.html">BotModule</a></li><li><a href="CommandManager.html">CommandManager</a></li><li><a href="FocaBotCore.html">FocaBotCore</a></li><li><a href="GuildAudioPlayer.html">GuildAudioPlayer</a></li><li><a href="GuildManager.html">GuildManager</a></li><li><a href="ModuleManager.html">ModuleManager</a></li><li><a href="PermissionsManager.html">PermissionsManager</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Fri Mar 03 2017 22:57:59 GMT-0400 (VET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
